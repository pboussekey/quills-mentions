{"code":"!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=1)}([function(e,t,n){\"use strict\";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}var o=Quill.import(\"delta\"),l=Quill.import(\"blots/inline\"),r=function(e){function t(){return s(this,t),function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l),i(t,[{key:\"isInvalid\",value:function(){return!this.domNode.classList.contains(\"editing\")&&this.domNode.getAttribute(\"data-id\")!==this.domNode.innerText||this.domNode.classList.contains(\"editing\")&&0!==this.domNode.innerText.indexOf(\"@\")}},{key:\"optimize\",value:function(){this.isInvalid()&&setTimeout(function(){this.remove()}.bind(this))}}],[{key:\"create\",value:function(e){var n=function e(t,n,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,n);if(void 0===s){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if(\"value\"in s)return s.value;var l=s.get;return void 0!==l?l.call(i):void 0}(t.__proto__||Object.getPrototypeOf(t),\"create\",this).call(this);return!0===e?(n.classList.remove(\"editing\"),n):(e.id?(n.dataset.id=e.id,n.classList.remove(\"editing\")):n.innerText=\"@\",e.label&&(0!==e.label.indexOf(\"@\")&&(e.label=\"@\"+e.label),n.dataset.label=e.label,n.dataset.text=e.text||e.label),n)}}]),t}();r.blotName=\"mention\",r.tagName=\"mention\",r.className=\"editing\",Quill.register(r);var a=function(){function e(t,n){s(this,e),this.quill=t,this.options=n,this.openAt=null,this.endAt=null,this.at=[],this.container=document.querySelector(n.container),t.on(\"text-change\",this.onChange.bind(this)),console.log(\"KEYBOARD?\",t.keyboard),t.keyboard.addBinding({key:13,format:[\"mention\"]},function(){return this.mention=t.getLeaf(range.index)[0].parent,this.mention.domNode.classList.contains(\"editing\")?this.selectElement():(this.mention.remove(),this.mention=null),!1}),t.keyboard.addBinding({key:\" \",format:[\"mention\"],prefix:/^@.*$/},function(e){if(this.mention=t.getLeaf(e.index)[0].parent,this.mention.domNode.classList.contains(\"editing\"))return this.promise?this.promise.then(function(){return 1===this.at.length?this.selectElement():this.at.length||this.stripMention(this.mention),!1}.bind(this)):(1===this.at.length?this.selectElement():this.at.length||this.stripMention(this.mention),!1);this.mention.remove(),this.mention=null}.bind(this)),t.keyboard.addBinding({key:37},function(e){var n=t.getLeaf(e.index)[0],i=n.parent,s=n.prev;if(\"MENTION\"!==i.domNode.tagName||i.domNode.classList.contains(\"editing\")||t.setSelection(i.offset()),s&&e.index===s.offset()+s.domNode.innerText.length&&\"MENTION\"===s.domNode.tagName&&!s.domNode.classList.contains(\"editing\")){if(0===s.offset())return!1;t.setSelection(s.offset())}return!0}.bind(this)),t.keyboard.addBinding({key:38,format:[\"mention\"]},function(){this.at&&this.at.length&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=this.container.querySelectorAll(\"button\")[this.selectedIndex],this.selectedElement&&this.selectedElement.classList.add(\"selected\"))}.bind(this)),t.keyboard.addBinding({key:39},function(e){var n=t.getLeaf(e.index)[0],i=n.parent,s=n.next;return\"MENTION\"!==i.domNode.tagName||i.domNode.classList.contains(\"editing\")||t.setSelection(i.offset()+i.domNode.innerText.length),s&&e.index===s.offset()&&\"MENTION\"===s.domNode.tagName&&!s.domNode.classList.contains(\"editing\")&&t.setSelection(s.offset()+s.domNode.innerText.length),!0}.bind(this)),t.keyboard.addBinding({key:40,format:[\"mention\"]},function(){this.selectedIndex=Math.min(this.at.length,this.selectedIndex+1),this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=this.container.querySelectorAll(\"button\")[this.selectedIndex],this.selectedElement&&this.selectedElement.classList.add(\"selected\")}.bind(this))}return i(e,[{key:\"onChange\",value:function(e,t,n){console.log(\"ON CHANGE\",e,n);var i=Math.max(0,e.ops.reduce(function(e,t){return e+(t.retain||0)-(t.delete||0)},0)),s=this.quill.getLeaf(i);this.mention=null,s[0]&&s[0].parent&&\"MENTION\"===s[0].parent.domNode.tagName&&(this.mention=s[0].parent),\"user\"===n&&(this.mention?this.searchAt(this.mention,this.mention.domNode.innerText.substring(1).trim()):!this.mention&&e.ops.some(function(e){return\"@\"===e.insert})&&(this.mention=this.addMention(i),this.searchAt(this.mention,\"\")),this.mention&&this.searchAt(this.mention,this.mention.domNode.innerText.substring(1).trim()))}},{key:\"searchAt\",value:function(e,t){var n=this.options.callback(t);this.last_search&&t.trim()===this.last_search||(this.last_search=t.trim(),n.then?(this.promise=n,n.then(function(n){this.promise=null,t===this.last_search&&this.processList(e,n,t)}.bind(this))):this.processList(e,n,t))}},{key:\"addMention\",value:function(e){this.quill.updateContents((new o).retain(e).delete(1));var t={id:\"\",label:\"\",text:\"\"};return this.quill.insertText(e,\" \",Quill.sources.API),this.quill.insertEmbed(e,\"mention\",t,Quill.sources.API),t=this.quill.getLeaf(e)[0].next||this.quill.getLeaf(e)[0].parent,this.quill.setSelection(e+1),t}},{key:\"validateMention\",value:function(e,t){var n=e.domNode.innerText.length;console.log(\"VALIDATE MENTION\",e,t),e.insertAt(0,t.id),e.deleteAt(t.id.length,n),e.domNode.setAttribute(\"data-id\",t.id),e.domNode.setAttribute(\"data-label\",\"@\"+t.label),e.domNode.setAttribute(\"data-text\",t.text||t.label),e.domNode.classList.remove(\"editing\"),this.emptyList(),setTimeout(function(){this.quill.focus(),this.quill.setSelection(e.offset()+e.domNode.innerText.length+1)}.bind(this),0)}},{key:\"stripMention\",value:function(e){var t=e.domNode.innerText||\"\",n=e.offset();e.deleteAt(0,e.domNode.innerText.length),this.quill.insertText(n,t,Quill.sources.API),this.emptyList(),setTimeout(function(){this.quill.focus(),this.quill.setSelection(n+t.length)}.bind(this),0)}},{key:\"emptyList\",value:function(){this.container.innerHTML=\"\",this.selectedIndex=0,this.selectedElement=null,document.removeEventListener(\"click\",this.emptyList,!0)}},{key:\"selectElement\",value:function(){this.mention&&this.at&&this.at[this.selectedIndex]&&this.validateMention(this.mention,this.at[this.selectedIndex]),this.emptyList()}},{key:\"processList\",value:function(e,t){this.emptyList(),this.at=t,t.forEach(function(t,n){var i=document.createElement(\"button\");if(i.className=\"ql-mention-list-item\",0===n&&(i.classList.add(\"selected\"),this.selectedElement=i),i.onclick=function(){this.validateMention(e,t)}.bind(this),i.onmouseover=function(){this.selectedIndex=n,this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=i,i.classList.add(\"selected\")}.bind(this),t.image){var s=new Image;s.src=t.image,i.appendChild(s)}else{var o=document.createElement(\"div\");o.classList.add(\"at\"),o.innerText=\"@\",i.appendChild(o)}i.innerHTML+=t.text||t.label,this.container.appendChild(i)}.bind(this)),document.addEventListener(\"click\",this.emptyList.bind(this),!0)}}]),e}();Quill.register(\"modules/twicmention\",a)},function(e,t,n){\"use strict\";var i,s=n(5);(i=s)&&i.__esModule,n(0)},,,,function(e,t){throw new Error('Module build failed: ModuleBuildError: Module build failed: \\n    background : $clr-background;\\n                ^\\n      Undefined variable: \"$clr-background\".\\n      in /srv/www/quills-mentions/src/css/core/_style.scss (line 11, column 18)\\n    at runLoaders (/srv/www/quills-mentions/node_modules/webpack/lib/NormalModule.js:252:20)\\n    at /srv/www/quills-mentions/node_modules/loader-runner/lib/LoaderRunner.js:364:11\\n    at /srv/www/quills-mentions/node_modules/loader-runner/lib/LoaderRunner.js:230:18\\n    at context.callback (/srv/www/quills-mentions/node_modules/loader-runner/lib/LoaderRunner.js:111:13)\\n    at Object.asyncSassJobQueue.push [as callback] (/srv/www/quills-mentions/node_modules/sass-loader/lib/loader.js:76:13)\\n    at Object.done [as callback] (/srv/www/quills-mentions/node_modules/neo-async/async.js:7974:18)\\n    at options.error (/srv/www/quills-mentions/node_modules/node-sass/lib/index.js:294:32)')}]);","extractedComments":[]}