{"code":"!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,\"a\",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p=\"\",i(i.s=1)}([function(e,t,i){\"use strict\";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}var o=Quill.import(\"delta\"),l=Quill.import(\"blots/inline\"),r=function(e){function t(){return s(this,t),function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l),n(t,[{key:\"isInvalid\",value:function(){return!this.domNode.classList.contains(\"editing\")&&this.domNode.getAttribute(\"data-id\")!==this.domNode.innerText||this.domNode.classList.contains(\"editing\")&&0!==this.domNode.innerText.indexOf(\"@\")}},{key:\"optimize\",value:function(){this.isInvalid()&&setTimeout(function(){this.remove()}.bind(this))}}],[{key:\"create\",value:function(e){var i=function e(t,i,n){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,n)}if(\"value\"in s)return s.value;var l=s.get;return void 0!==l?l.call(n):void 0}(t.__proto__||Object.getPrototypeOf(t),\"create\",this).call(this);return!0===e?(i.classList.remove(\"editing\"),i):(e.id?(i.dataset.id=e.id,i.classList.remove(\"editing\")):i.innerText=\"@\",e.label&&(0!==e.label.indexOf(\"@\")&&(e.label=\"@\"+e.label),i.dataset.label=e.label,i.dataset.text=e.text||e.label),i)}}]),t}();r.blotName=\"mention\",r.tagName=\"mention\",r.className=\"editing\",Quill.register(r);var a=function(){function e(t,i){s(this,e),this.quill=t,this.options=i,this.openAt=null,this.endAt=null,this.at=[],this.container=document.querySelector(i.container),t.on(\"text-change\",this.onChange.bind(this)),console.log(\"KEYBOARD?\",t.keyboard),t.keyboard.addBinding({key:13,format:[\"mention\"]},function(){return this.mention=t.getLeaf(range.index)[0].parent,this.mention.domNode.classList.contains(\"editing\")?this.selectElement():(this.mention.remove(),this.mention=null),!1}),t.keyboard.addBinding({key:\" \",format:[\"mention\"],prefix:/^@.*$/},function(e){if(this.mention=t.getLeaf(e.index)[0].parent,this.mention.domNode.classList.contains(\"editing\"))return this.promise?this.promise.then(function(){return 1===this.at.length?this.selectElement():this.at.length||this.stripMention(this.mention),!1}.bind(this)):(1===this.at.length?this.selectElement():this.at.length||this.stripMention(this.mention),!1);this.mention.remove(),this.mention=null}.bind(this)),t.keyboard.addBinding({key:37},function(e){var i=t.getLeaf(e.index)[0],n=i.parent,s=i.prev;if(\"MENTION\"!==n.domNode.tagName||n.domNode.classList.contains(\"editing\")||t.setSelection(n.offset()),s&&e.index===s.offset()+s.domNode.innerText.length&&\"MENTION\"===s.domNode.tagName&&!s.domNode.classList.contains(\"editing\")){if(0===s.offset())return!1;t.setSelection(s.offset())}return!0}.bind(this)),t.keyboard.addBinding({key:38,format:[\"mention\"]},function(){this.at&&this.at.length&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=this.container.querySelectorAll(\"button\")[this.selectedIndex],this.selectedElement&&this.selectedElement.classList.add(\"selected\"))}.bind(this)),t.keyboard.addBinding({key:39},function(e){var i=t.getLeaf(e.index)[0],n=i.parent,s=i.next;return\"MENTION\"!==n.domNode.tagName||n.domNode.classList.contains(\"editing\")||t.setSelection(n.offset()+n.domNode.innerText.length),s&&e.index===s.offset()&&\"MENTION\"===s.domNode.tagName&&!s.domNode.classList.contains(\"editing\")&&t.setSelection(s.offset()+s.domNode.innerText.length),!0}.bind(this)),t.keyboard.addBinding({key:40,format:[\"mention\"]},function(){this.selectedIndex=Math.min(this.at.length,this.selectedIndex+1),this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=this.container.querySelectorAll(\"button\")[this.selectedIndex],this.selectedElement&&this.selectedElement.classList.add(\"selected\")}.bind(this))}return n(e,[{key:\"onChange\",value:function(e,t,i){console.log(\"ON CHANGE\",e,i);var n=Math.max(0,e.ops.reduce(function(e,t){return e+(t.retain||0)-(t.delete||0)},0)),s=this.quill.getLeaf(n);this.mention=null,s[0]&&s[0].parent&&\"MENTION\"===s[0].parent.domNode.tagName&&(this.mention=s[0].parent),\"user\"===i&&(this.mention?this.searchAt(this.mention,this.mention.domNode.innerText.substring(1).trim()):!this.mention&&e.ops.some(function(e){return\"@\"===e.insert})&&(this.mention=this.addMention(n),this.searchAt(this.mention,\"\")),this.mention&&this.searchAt(this.mention,this.mention.domNode.innerText.substring(1).trim()))}},{key:\"searchAt\",value:function(e,t){var i=this.options.callback(t);this.last_search&&t.trim()===this.last_search||(this.last_search=t.trim(),i.then?(this.promise=i,i.then(function(i){this.promise=null,t===this.last_search&&this.processList(e,i,t)}.bind(this))):this.processList(e,i,t))}},{key:\"addMention\",value:function(e){this.quill.updateContents((new o).retain(e).delete(1));var t={id:\"\",label:\"\",text:\"\"};return this.quill.insertText(e,\" \",Quill.sources.API),this.quill.insertEmbed(e,\"mention\",t,Quill.sources.API),t=this.quill.getLeaf(e)[0].next||this.quill.getLeaf(e)[0].parent,this.quill.setSelection(e+1),t}},{key:\"validateMention\",value:function(e,t){var i=e.domNode.innerText.length;console.log(\"VALIDATE MENTION\",e,t),e.insertAt(0,t.id),e.deleteAt(t.id.length,i),e.domNode.setAttribute(\"data-id\",t.id),e.domNode.setAttribute(\"data-label\",\"@\"+t.label),e.domNode.setAttribute(\"data-text\",t.text||t.label),e.domNode.classList.remove(\"editing\"),this.emptyList(),setTimeout(function(){this.quill.focus(),this.quill.setSelection(e.offset()+e.domNode.innerText.length+1)}.bind(this),0)}},{key:\"stripMention\",value:function(e){var t=e.domNode.innerText||\"\",i=e.offset();e.deleteAt(0,e.domNode.innerText.length),this.quill.insertText(i,t,Quill.sources.API),this.emptyList(),setTimeout(function(){this.quill.focus(),this.quill.setSelection(i+t.length)}.bind(this),0)}},{key:\"emptyList\",value:function(){this.container.innerHTML=\"\",this.selectedIndex=0,this.selectedElement=null,document.removeEventListener(\"click\",this.emptyList,!0)}},{key:\"selectElement\",value:function(){this.mention&&this.at&&this.at[this.selectedIndex]&&this.validateMention(this.mention,this.at[this.selectedIndex]),this.emptyList()}},{key:\"processList\",value:function(e,t){this.emptyList(),this.at=t,t.forEach(function(t,i){var n=document.createElement(\"button\");if(n.className=\"ql-mention-list-item\",0===i&&(n.classList.add(\"selected\"),this.selectedElement=n),n.onclick=function(){this.validateMention(e,t)}.bind(this),n.onmouseover=function(){this.selectedIndex=i,this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=n,n.classList.add(\"selected\")}.bind(this),t.image){var s=new Image;s.src=t.image,n.appendChild(s)}else{var o=document.createElement(\"div\");o.classList.add(\"at\"),o.innerText=\"@\",n.appendChild(o)}n.innerHTML+=t.text||t.label,this.container.appendChild(n)}.bind(this)),document.addEventListener(\"click\",this.emptyList.bind(this),!0)}}]),e}();Quill.register(\"modules/twicmention\",a)},function(e,t,i){\"use strict\";var n,s=i(!function(){var e=new Error('Cannot find module \"./css/ql-mention.css\"');throw e.code=\"MODULE_NOT_FOUND\",e}());(n=s)&&n.__esModule,i(0)}]);","extractedComments":[]}