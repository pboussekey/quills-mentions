{"code":"!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,\"__esModule\",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=5)}([function(e,t,n){\"use strict\";var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function s(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}var o=Quill.import(\"delta\"),r=Quill.import(\"blots/inline\"),l=function(e){function t(){return s(this,t),function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),i(t,[{key:\"isInvalid\",value:function(){return!this.domNode.classList.contains(\"editing\")&&this.domNode.getAttribute(\"data-id\")!==this.domNode.innerText||this.domNode.classList.contains(\"editing\")&&0!==this.domNode.innerText.indexOf(\"@\")}},{key:\"optimize\",value:function(){this.isInvalid()&&setTimeout(function(){this.remove()}.bind(this))}}],[{key:\"create\",value:function(e){var n=function e(t,n,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,n);if(void 0===s){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if(\"value\"in s)return s.value;var r=s.get;return void 0!==r?r.call(i):void 0}(t.__proto__||Object.getPrototypeOf(t),\"create\",this).call(this);return!0===e?(n.classList.remove(\"editing\"),n):(e.id?(n.dataset.id=e.id,n.classList.remove(\"editing\")):n.innerText=\"@\",e.label&&(0!==e.label.indexOf(\"@\")&&(e.label=\"@\"+e.label),n.dataset.label=e.label,n.dataset.text=e.text||e.label),n)}}]),t}();l.blotName=\"mention\",l.tagName=\"mention\",l.className=\"editing\",Quill.register(l);var a=function(){function e(t,n){s(this,e),this.quill=t,this.options=n,this.openAt=null,this.endAt=null,this.at=[],this.container=document.querySelector(n.container),t.on(\"text-change\",this.onChange.bind(this)),console.log(\"KEYBOARD?\",t.keyboard),t.keyboard.addBinding({key:13,format:[\"mention\"]},function(){return this.mention=t.getLeaf(range.index)[0].parent,this.mention.domNode.classList.contains(\"editing\")?this.selectElement():(this.mention.remove(),this.mention=null),!1}),t.keyboard.addBinding({key:\" \",format:[\"mention\"],prefix:/^@.*$/},function(e){if(this.mention=t.getLeaf(e.index)[0].parent,this.mention.domNode.classList.contains(\"editing\"))return this.promise?this.promise.then(function(){return 1===this.at.length?this.selectElement():this.at.length||this.stripMention(this.mention),!1}.bind(this)):(1===this.at.length?this.selectElement():this.at.length||this.stripMention(this.mention),!1);this.mention.remove(),this.mention=null}.bind(this)),t.keyboard.addBinding({key:37},function(e){var n=t.getLeaf(e.index)[0],i=n.parent,s=n.prev;if(\"MENTION\"!==i.domNode.tagName||i.domNode.classList.contains(\"editing\")||t.setSelection(i.offset()),s&&e.index===s.offset()+s.domNode.innerText.length&&\"MENTION\"===s.domNode.tagName&&!s.domNode.classList.contains(\"editing\")){if(0===s.offset())return!1;t.setSelection(s.offset())}return!0}.bind(this)),t.keyboard.addBinding({key:38,format:[\"mention\"]},function(){this.at&&this.at.length&&(this.selectedIndex=Math.max(0,this.selectedIndex-1),this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=this.container.querySelectorAll(\"button\")[this.selectedIndex],this.selectedElement&&this.selectedElement.classList.add(\"selected\"))}.bind(this)),t.keyboard.addBinding({key:39},function(e){var n=t.getLeaf(e.index)[0],i=n.parent,s=n.next;return\"MENTION\"!==i.domNode.tagName||i.domNode.classList.contains(\"editing\")||t.setSelection(i.offset()+i.domNode.innerText.length),s&&e.index===s.offset()&&\"MENTION\"===s.domNode.tagName&&!s.domNode.classList.contains(\"editing\")&&t.setSelection(s.offset()+s.domNode.innerText.length),!0}.bind(this)),t.keyboard.addBinding({key:40,format:[\"mention\"]},function(){this.selectedIndex=Math.min(this.at.length,this.selectedIndex+1),this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=this.container.querySelectorAll(\"button\")[this.selectedIndex],this.selectedElement&&this.selectedElement.classList.add(\"selected\")}.bind(this))}return i(e,[{key:\"onChange\",value:function(e,t,n){console.log(\"ON CHANGE\",e,n);var i=Math.max(0,e.ops.reduce(function(e,t){return e+(t.retain||0)-(t.delete||0)},0)),s=this.quill.getLeaf(i);this.mention=null,s[0]&&s[0].parent&&\"MENTION\"===s[0].parent.domNode.tagName&&(this.mention=s[0].parent),\"user\"===n&&(this.mention?this.searchAt(this.mention,this.mention.domNode.innerText.substring(1).trim()):!this.mention&&e.ops.some(function(e){return\"@\"===e.insert})&&(this.mention=this.addMention(i),this.searchAt(this.mention,\"\")),this.mention&&this.searchAt(this.mention,this.mention.domNode.innerText.substring(1).trim()))}},{key:\"searchAt\",value:function(e,t){var n=this.options.callback(t);this.last_search&&t.trim()===this.last_search||(this.last_search=t.trim(),n.then?(this.promise=n,n.then(function(n){this.promise=null,t===this.last_search&&this.processList(e,n,t)}.bind(this))):this.processList(e,n,t))}},{key:\"addMention\",value:function(e){this.quill.updateContents((new o).retain(e).delete(1));var t={id:\"\",label:\"\",text:\"\"};return this.quill.insertText(e,\" \",Quill.sources.API),this.quill.insertEmbed(e,\"mention\",t,Quill.sources.API),t=this.quill.getLeaf(e)[0].next||this.quill.getLeaf(e)[0].parent,this.quill.setSelection(e+1),t}},{key:\"validateMention\",value:function(e,t){var n=e.domNode.innerText.length;console.log(\"VALIDATE MENTION\",e,t),e.insertAt(0,t.id),e.deleteAt(t.id.length,n),e.domNode.setAttribute(\"data-id\",t.id),e.domNode.setAttribute(\"data-label\",\"@\"+t.label),e.domNode.setAttribute(\"data-text\",t.text||t.label),e.domNode.classList.remove(\"editing\"),this.emptyList(),setTimeout(function(){this.quill.focus(),this.quill.setSelection(e.offset()+e.domNode.innerText.length+1)}.bind(this),0)}},{key:\"stripMention\",value:function(e){var t=e.domNode.innerText||\"\",n=e.offset();e.deleteAt(0,e.domNode.innerText.length),this.quill.insertText(n,t,Quill.sources.API),this.emptyList(),setTimeout(function(){this.quill.focus(),this.quill.setSelection(n+t.length)}.bind(this),0)}},{key:\"emptyList\",value:function(){this.container.innerHTML=\"\",this.selectedIndex=0,this.selectedElement=null,document.removeEventListener(\"click\",this.emptyList,!0)}},{key:\"selectElement\",value:function(){this.mention&&this.at&&this.at[this.selectedIndex]&&this.validateMention(this.mention,this.at[this.selectedIndex]),this.emptyList()}},{key:\"processList\",value:function(e,t){this.emptyList(),this.at=t,t.forEach(function(t,n){var i=document.createElement(\"button\");if(i.className=\"ql-mention-list-item\",0===n&&(i.classList.add(\"selected\"),this.selectedElement=i),i.onclick=function(){this.validateMention(e,t)}.bind(this),i.onmouseover=function(){this.selectedIndex=n,this.selectedElement&&this.selectedElement.classList.remove(\"selected\"),this.selectedElement=i,i.classList.add(\"selected\")}.bind(this),t.image){var s=new Image;s.src=t.image,i.appendChild(s)}else{var o=document.createElement(\"div\");o.classList.add(\"at\"),o.innerText=\"@\",i.appendChild(o)}i.innerHTML+=t.text||t.label,this.container.appendChild(i)}.bind(this)),document.addEventListener(\"click\",this.emptyList.bind(this),!0)}}]),e}();Quill.register(\"modules/twicmention\",a)},function(e,t){e.exports=function(e){var t=\"undefined\"!=typeof window&&window.location;if(!t)throw new Error(\"fixUrls requires window.location\");if(!e||\"string\"!=typeof e)return e;var n=t.protocol+\"//\"+t.host,i=n+t.pathname.replace(/\\/[^\\/]*$/,\"/\");return e.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi,function(e,t){var s,o=t.trim().replace(/^\"(.*)\"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(o)?e:(s=0===o.indexOf(\"//\")?o:0===o.indexOf(\"/\")?n+o:i+o.replace(/^\\.\\//,\"\"),\"url(\"+JSON.stringify(s)+\")\")})}},function(e,t,n){var i,s,o={},r=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=i.apply(this,arguments)),s}),l=function(e){var t={};return function(e){if(\"function\"==typeof e)return e();if(void 0===t[e]){var n=function(e){return document.querySelector(e)}.call(this,e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),a=null,d=0,c=[],u=n(1);function h(e,t){for(var n=0;n<e.length;n++){var i=e[n],s=o[i.id];if(s){s.refs++;for(var r=0;r<s.parts.length;r++)s.parts[r](i.parts[r]);for(;r<i.parts.length;r++)s.parts.push(g(i.parts[r],t))}else{var l=[];for(r=0;r<i.parts.length;r++)l.push(g(i.parts[r],t));o[i.id]={id:i.id,refs:1,parts:l}}}}function f(e,t){for(var n=[],i={},s=0;s<e.length;s++){var o=e[s],r=t.base?o[0]+t.base:o[0],l={css:o[1],media:o[2],sourceMap:o[3]};i[r]?i[r].parts.push(l):n.push(i[r]={id:r,parts:[l]})}return n}function m(e,t){var n=l(e.insertInto);if(!n)throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");var i=c[c.length-1];if(\"top\"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),c.push(t);else if(\"bottom\"===e.insertAt)n.appendChild(t);else{if(\"object\"!=typeof e.insertAt||!e.insertAt.before)throw new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");var s=l(e.insertInto+\" \"+e.insertAt.before);n.insertBefore(t,s)}}function p(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=c.indexOf(e);t>=0&&c.splice(t,1)}function v(e){var t=document.createElement(\"style\");return void 0===e.attrs.type&&(e.attrs.type=\"text/css\"),b(t,e.attrs),m(e,t),t}function b(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function g(e,t){var n,i,s,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var r=d++;n=a||(a=v(t)),i=N.bind(null,n,r,!1),s=N.bind(null,n,r,!0)}else e.sourceMap&&\"function\"==typeof URL&&\"function\"==typeof URL.createObjectURL&&\"function\"==typeof URL.revokeObjectURL&&\"function\"==typeof Blob&&\"function\"==typeof btoa?(n=function(e){var t=document.createElement(\"link\");return void 0===e.attrs.type&&(e.attrs.type=\"text/css\"),e.attrs.rel=\"stylesheet\",b(t,e.attrs),m(e,t),t}(t),i=function(e,t,n){var i=n.css,s=n.sourceMap,o=void 0===t.convertToAbsoluteUrls&&s;(t.convertToAbsoluteUrls||o)&&(i=u(i));s&&(i+=\"\\n/*# sourceMappingURL=data:application/json;base64,\"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+\" */\");var r=new Blob([i],{type:\"text/css\"}),l=e.href;e.href=URL.createObjectURL(r),l&&URL.revokeObjectURL(l)}.bind(null,n,t),s=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(t),i=function(e,t){var n=t.css,i=t.media;i&&e.setAttribute(\"media\",i);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),s=function(){p(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else s()}}e.exports=function(e,t){if(\"undefined\"!=typeof DEBUG&&DEBUG&&\"object\"!=typeof document)throw new Error(\"The style-loader cannot be used in a non-browser environment\");(t=t||{}).attrs=\"object\"==typeof t.attrs?t.attrs:{},t.singleton||\"boolean\"==typeof t.singleton||(t.singleton=r()),t.insertInto||(t.insertInto=\"head\"),t.insertAt||(t.insertAt=\"bottom\");var n=f(e,t);return h(n,t),function(e){for(var i=[],s=0;s<n.length;s++){var r=n[s];(l=o[r.id]).refs--,i.push(l)}e&&h(f(e,t),t);for(s=0;s<i.length;s++){var l;if(0===(l=i[s]).refs){for(var a=0;a<l.parts.length;a++)l.parts[a]();delete o[l.id]}}}};var y,x=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join(\"\\n\")});function N(e,t,n,i){var s=n?\"\":i.css;if(e.styleSheet)e.styleSheet.cssText=x(t,s);else{var o=document.createTextNode(s),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}},function(e,t){throw new Error(\"Module build failed: Error: No PostCSS Config found in: /srv/www/quills-mentions/src/css\\n    at /srv/www/quills-mentions/node_modules/postcss-load-config/index.js:51:26\\n    at <anonymous>\")},function(e,t,n){var i=n(3);\"string\"==typeof i&&(i=[[e.i,i,\"\"]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(2)(i,s);i.locals&&(e.exports=i.locals)},function(e,t,n){\"use strict\";var i,s=n(4);(i=s)&&i.__esModule,n(0)}]);","extractedComments":[]}